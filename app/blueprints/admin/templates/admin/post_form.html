{% extends "admin/admin_base.html" %}
{% set active_menu = 'post_new' if not post else 'post_list' %}

{% block title %}{{ title }}{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/tinymce/tinymce.min.js') }}"></script>
<script>
    tinymce.init({
        license_key: 'gpl',
        selector: '#content',
        language: 'ja',
        height: 500,
        plugins: [
            'advlist', 'autolink', 'lists', 'link', 'image', 'charmap', 'preview',
            'anchor', 'searchreplace', 'visualblocks', 'code', 'fullscreen',
            'insertdatetime', 'media', 'table', 'help', 'wordcount'
        ],
        toolbar: 'undo redo | blocks | ' +
            'bold italic underline strikethrough | alignleft aligncenter ' +
            'alignright alignjustify | bullist numlist outdent indent | ' +
            'link image media | table | removeformat | help',
        content_style: 'body { font-family: "Noto Sans JP", sans-serif; font-size:14px }',
        branding: false,
        promotion: false,
        elementpath: false,
        menubar: 'edit insert view format table tools help',
        skin: 'oxide',
        content_css: 'default'
    });
</script>
{% endblock %}

{% block main_content %}
<!-- PAGE HEADER -->
<div class="flex flex-col gap-2">
    <div class="flex items-center gap-1.5 text-[11px] font-mono-dm text-custom-text-muted uppercase tracking-wider">
        <span class="text-custom-accent font-bold">Admin</span>
        <span class="opacity-40">/</span>
        <span class="text-custom-accent font-bold">Posts</span>
        <span class="opacity-40">/</span>
        <span>{{ 'Edit Post' if post else 'New Post' }}</span>
    </div>
    <div class="flex items-center gap-4">
        <a href="{{ url_for('admin.post_list') }}"
            class="text-custom-text-muted hover:text-custom-accent transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-6 h-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />
            </svg>
        </a>
        <h1 class="text-2xl md:text-3xl font-header-sans font-bold text-custom-text-primary tracking-tight">{{ title }}
        </h1>
    </div>
</div>

<!-- FORM CARD -->
<div class="bg-white border border-custom-border rounded-custom shadow-custom-sm overflow-hidden max-w-4xl">
    <form method="POST" class="p-6 md:p-8 flex flex-col gap-6">
        <!-- 見出し -->
        <div>
            <label for="title" class="label-admin">見出し</label>
            <input type="text" id="title" name="title" value="{{ post.title if post else '' }}" placeholder="記事のタイトルを入力"
                class="input-admin text-base font-bold" required>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- カテゴリー -->
            <div>
                <label for="category_id" class="label-admin">カテゴリー</label>
                <div class="relative">
                    <select id="category_id" name="category_id"
                        class="input-admin appearance-none cursor-pointer pr-10">
                        {% for category in categories %}
                        <option value="{{ category.id }}" {{ 'selected' if post and post.category_id==category.id
                            else '' }}>{{ category.name }}</option>
                        {% endfor %}
                    </select>
                    <span
                        class="absolute right-3.5 top-1/2 -translate-y-1/2 text-[10px] text-custom-text-muted pointer-events-none">▼</span>
                </div>
            </div>

            <!-- 公開状態 -->
            <div>
                <label for="status" class="label-admin">公開状態</label>
                <div class="relative">
                    <select id="status" name="status" class="input-admin appearance-none cursor-pointer pr-10">
                        <option value="published" {{ 'selected' if not post or post.status=='published' else '' }}>直ちに公開
                        </option>
                        <option value="draft" {{ 'selected' if post and post.status=='draft' else '' }}>下書き保存</option>
                    </select>
                    <span
                        class="absolute right-3.5 top-1/2 -translate-y-1/2 text-[10px] text-custom-text-muted pointer-events-none">▼</span>
                </div>
            </div>
        </div>

        <!-- 本文 -->
        <div>
            <label for="content" class="label-admin">本文</label>
            <textarea id="content" name="content" rows="15" placeholder="記事の内容を記述してください（Markdown対応予定）"
                class="input-admin h-auto py-3 resize-none font-sans text-sm leading-relaxed"
                required>{{ post.content if post else '' }}</textarea>
        </div>

        <!-- ACTIONS -->
        <div class="flex items-center justify-end gap-4 pt-4 border-t border-custom-border-light">
            <a href="{{ url_for('admin.post_list') }}"
                class="text-xs font-bold text-custom-text-muted hover:text-custom-text-secondary transition-colors uppercase tracking-widest font-mono-dm">Cancel</a>
            <button type="submit" class="btn-admin-primary px-8 py-2.5 text-sm">
                {{ '更新して保存' if post else 'この記事を投稿する' }}
            </button>
        </div>
    </form>
</div>
{% endblock %}